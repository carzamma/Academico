---
title:  'Modelos de Poisson: Magnitud del factor de dispersión y su efecto en la estimación de intervalos de confianza'
thanks: "Replication files are available on the author's Github account..."
author:
- Gamboa, C.
- Martínez, L.
- Zamora, C.
date: "`r format(Sys.time(), '%d %B %Y')`"
tags: [nothing, nothingness]
abstract: "Resumen del artículo"
keywords: "poisson, overdispersion, r, regression, pearson"
geometry: margin=1in
output: 
    pdf_document:
        template: NULL
        toc: true
        number_sections: true
        toc_depth: 3
        fig_width: 7
        fig_height: 6
        fig_caption: true
        pandoc_args: ["-V", "classoption=twocolumn"]
---

#Introducción.      

Una de las distribuciones de probabilidad más utilizadas en la teoría de probabilidad es la distribución de Poisson[^1]. Se trata de distribución de probabilidad discreta que se adapta bien a problemas relacionados con conteos, o cuando un evento ocurre cierta cantidad de veces a lo largo del tiempo y tiene trabaja de mejor manera cuando se estudian sucesos cuyas probabilidades son pequeñas, es decir, eventos poco frecuentes. Esta distribución cuenta con un único parámetro, al cual llamaremos $\lambda$, que representa la media.     

Al trabajar con modelos estadísticos basados en la distribución de Poisson, se deben cumplir una serie de supuestos pero quizá el más importante sea el que se relaciona sus momentos, en particular su media y su variancia, pues en el caso de la distribución de Poisson, ambas deben ser iguales. Es por esto que gran parte de los errores de especificación de un determinado modelo conllevan una violación de este supuesto fundamental: la igualdad entre media y variancia condicionales.             

Cuando los datos provienen de una distribución donde la media es menor a la variancia, y se quiere asumir una distribución Poisson, se está ante un problema de sobredispersión. El problema de la sobredispersión es más una consecuencia de la falta de equidispersión. La mayor parte de las pruebas que diagnostican la sobredispersión pueden considerarse algo genéricas en el sentido de que en realidad detectan la ausencia de equidispersión y no específicamente la presencia de sobredispersión.        

Este último es el principal motivo por el cual se quiere realizar este estudio. Mediante este trabajo, se pretende estudiar las correcciones que se hacen a los errores estándar de los coeficientes de un modelo de regresión de Poisson, mediante el uso del parámetro de dispersión[^2], con el fin de conocer a partir de qué punto se puede considerar que este parámetro $(\phi)$ es lo suficientemente grande como para tener que trabajar con un modelo de regresión quasipoisson dado que se desconoce un criterio el cual indique a partir de qué punto la sobredispersión (medida mediante $\phi$) puede generar diferencias relevantes en los errores.               

[^2]: Este parámetro se calcula mediante el uso de los residuales de Pearson.

Mediante el uso de simulaciones, se obtendrán diversos parámetros de dispersión para distintos tamaños de muestra. Esto brindará la posibilidad de generar intervalos de confianza y compararlos entre sí para detectar a partir de qué punto la sobredispersión diagnosticada genera diferencias considerablemente importantes en las estimaciones entre los distintos modelos, con el fin de explorar el efecto que tiene la sobredispersión sobre las estimaciones de los intervalos de confianza en los modelos.        

##Objetivos.        

*   **Objetivo general.**       

Brindar un criterio para clasificar la relevancia de la sobredispersión en un modelo de Poisson (medida mediante el factor de dispersión) mediante la magnitud de $\phi$.       

*   **Objetivos específicos.**      
    +   Generar una función en el software estadístico R[^3] para obtener datos de una distribución de Poisson con presencia de sobredispersión.       
    +   Objetivo específico 2       

[^3]: [https://www.r-project.org/](https://www.r-project.org/)

#Metodología.       

La distribución de Poisson forma parte de la familia exponencial, por lo que gusrada una estrecha relaciones con varias distribucionesde probabilidad, como lo son la Gamma, la Exponencial o la Binomial Negativa, siendo esta última de particular interés en este estudio.        

Es importante conocer algunos aspectos de la distribución de Poisson, como su función de densidad y su función generadora de momentos, dado que con ambas se pueden encontrar los momentos relacionados con la esperanza y la variancia:       

$$P(X=x| \lambda)=\frac{e^{-\lambda}\cdot \lambda^x}{x!}$$        

$$E(e^{tX})=\sum_{x=0}^{\inf} {e^{tk}\cdot f(x; \lambda)}=
\sum_{x=0}^{\inf} e^{tk}\frac{e^{-\lambda}\cdot \lambda^x}{x!}=e^{\lambda(e^t-1)}$$

$$E(X)=\lambda ; Var(X)=\lambda$$

Donde $k$ es el número de veces que ocurre el evento, $\lambda$ es un parámetro positivo que representa la media de veces que ocurre el evento y $e$ es la base del logaritmo natural.

Interesa entonces obtener una muestra aleatoria de números de una distribución de Poisson para los cuales el valor de su media sea menor al de su variancia, es decir, datos con sobredispersión. Para poder lograr esto, es importante primero introducir otra distribución perteneciente a la familia exponencial, la distribución Binomial Negativa. Se presentan a continuación su función de densidad, su generadora de momentos, su esperanza matemática y su variancia.      

$$P(X=x|k,\lambda)=\frac{\Gamma(x+k)}{\Gamma(k)\Gamma(x+1)}\left(\frac{k}{\lambda+k}\right)^k\left(1-\frac{k}{\lambda+k}\right)^y$$

$$\left(\frac{x}{1-(1-x)e^t}\right)^k$$

$$E(X)=\lambda ; Var(X)=\lambda+\frac{\lambda^2}{k}$$

Note que, si se tiene una distribución Binomial Negativa cuyo parámetro $k$ tiende a infinito, entonces la distribución se vuelve una distribución de Poisson. Dado que la razón de este estudio es el parámetro de dispersión $(\phi)$ se observa la estrecha relación que tienen la distribución de Poisson y la Binomial Negativa, es de particular interés conocer la relación existente entre $\phi$, que es una constante de proporcionalidad y el parámetro $k$.      

Cuando existe sobredispersión en una distribución de Poisson, los errores estándar quedan multiplicados por $\phi$, esto con el fin de controlar el error que se está generando. Así, si $\phi=1$ se estaría trabajando con una distribución de Poisson, pero cuando esto no sucede, se trabajaría con una distribución Quasipoisson[^5].        

[^5]: Buscar referencia de Quasipoisson.        

Dicho esto, en términos generales puede decirse que la variancia de una distribución de Poisson está dada por $Var(X)=\phi\lambda$, y al asociar esta varaincia con la variancia de la distribución Binomial Negativa es posible encontrar una relación entre $\phi$ y $k$ como sigue:      

$$\phi\lambda=\lambda+\frac{\lambda^2}{k}$$
$$\Leftrightarrow \phi=1+\frac{\lambda}{k}$$
$$\Leftrightarrow k=\frac{\lambda}{\phi-1}$$

Al definir esta relación es posible obtener un valor de $k$ que permita generar números pseudoaleatorios de una distribución Binomial Negativa con media $\lambda$ que a su vez sean números pseudoaleatorios de una distribución de Poisson con media $\lambda$ y bien aproximados a una determinada dispersión $\phi$.      

Al conocer las condiciones que se deben cumplir, es posible utilizar el software estadístico R para generar una función brinde los datos simulados adecuados. Como los coeficientes no son de particular interés en este estudio, se definirá un único predictor llamado $x$ con el cual se creará un modelo lineal generalizado en conjunto con una variable de respuesta $y$, que serán los números pseudoaleatorios de la distribución de Poisson con sobredispersión. La función que permite esto se programa de la siguiente manera.        


```{r opts_chunk$set(cache=TRUE)}
```

```{r, results='hide'}
rpoisdisp<-function(lambda=10, 
                    N=5000, 
                    rep=2, 
                    phi)
{
    if(rep==0)
    stop("El número de réplicas debe 
          ser mayor a cero")
    if(lambda==0)
    stop("El valor de lambda debe 
          ser mayor a cero")
    if(phi==1)
    {
      y<-rpois(N,lambda)
    }
    else
    {
     ni<-N/rep
     k<-lambda/(phi-1)
     y<-rnbinom(n=N, size=k, mu=lambda)
     x<-rep(1:rep, ni)
     mod<-glm(y~factor(x),
              family=quasipoisson)
    }
    list(Dispersion=summary(mod)$disp, 
         Y=y, X=x)
}
```

La función *rpoisdisp* cuenta con cuatro parámetros, a saber:       

*   $\lambda$: La media de la distribución, su valor predeterminado es 10.     

*   $N$: La cantidad de valores que se desean generar. Para tener una buena aproximación a la dispersión deseada este valor debe ser grande, por eso se define 5000 como valor predeterminado.     

*   $rep$: Es el número de repeticiones por tratamiento. Por ejemplo, si el predictor $x$ cuenta con solo dos niveles y se mantienen los valores predeterminados de la función, entonces cada nivel de $x$ tendrá 2500 repeticiones.     

*   $phi$: Se refiere a valor del parámetro de dispersión que se desea en los datos.       


#Resultados.        

#Discusión e interpretación.        
